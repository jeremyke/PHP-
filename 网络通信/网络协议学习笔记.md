 ## 1. 计算机网络体系结构
 
 ![image](https://github.com/jeremyke/PHPBlog/raw/master/Pictures/network-architecture-02.png)
 
 **各层作用**
 
 应用层：应用层协议定义的是应用进程间通信和交互的规则
 
 运输层：运输层的任务就是负责向两台主机中进程之间的通信提供通用的数据传输服务
 
 网络层：把运输层产生的报文段或用户数据报封装成分组或包进行传送
 
 数据链路层：将网络层交下来的 IP 数据报组装成帧，并在两个相邻结点间的链路上传送
 
 物理层：利用物理媒体以比特形式传送数据
 
 ## 2. UDP
 
 - UDP特点
 ```text
    UDP 是无连接的，即发送数据之前不需要建立连接(发送数据结束时也没有连接可释放)，减少了开销和发送数据之前的时延
    UDP 使用尽最大努力交付，即不保证可靠交付，主机不需要维持复杂的连接状态表
    UDP 是面向报文的，发送方的UDP是对应用程序交下来的报文，然后在添加首部后就向下交付IP层。UDP对应用层交下来的报文，既不合并，也不拆分,
 而是保留这些报文的边界。
    UDP 没有拥塞控制,网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应用是很重要的
    UDP 支持一对一、一对多、多对一和多对多的交互通信
    UDP 的首部开销小，只有8个字节，比 TCP 的20个字节的首部要短
 ```
 - 流和数据的区别？
 ```text
 “TCP是一种流模式的协议，UDP是一种数据报模式的协议”:
 1、TCP
 
 打个比方比喻TCP，你家里有个蓄水池，你可以里面倒水，蓄水池上有个龙头，你可以通过龙头将水池里的水放出来，然后用各种各样的容器装（杯子、矿泉水瓶、锅碗瓢盆）接水。 上面的例子中，往水池里倒几次水和接几次水是没有必然联系的，也就是说你可以只倒一次水，然后分10次接完。另外，水池里的水接多少就会少多少；往里面倒多少水，就会增加多少水，但是不能超过水池的容量，多出的水会溢出。
 
 结合TCP的概念，水池就好比接收缓存，倒水就相当于发送数据，接水就相当于读取数据。好比你通过TCP连接给另一端发送数据，你只调用了一次write，发送了100个字节，但是对方可以分10次收完，每次10个字节；你也可以调用10次write，每次10个字节，但是对方可以一次就收完。（假设数据都能到达）但是，你发送的数据量不能大于对方的接收缓存（流量控制），如果你硬是要发送过量数据，则对方的缓存满了就会把多出的数据丢弃。 这种情况是设置非阻塞I/O模型，会把内存耗尽，因为socket是存在内核中的。
 
 2、UDP
 
 UDP和TCP不同，发送端调用了几次write，接收端必须用相同次数的read读完。UPD是基于报文的，在接收的时候，每次最多只能读取一个报文，报文和报文是不会合并的，如果缓冲区小于报文长度，则多出的部分会被丢弃。也就说，如果不指定MSG_PEEK标志，每次读取操作将消耗一个报文。
 
 3、为什么
 
 其实，这种不同是由TCP和UDP的特性决定的。TCP是面向连接的，也就是说，在连接持续的过程中，socket中收到的数据都是由同一台主机发出的（劫持什么的不考虑），因此，知道保证数据是有序的到达就行了，至于每次读取多少数据自己看着办。
 
 而UDP是无连接的协议，也就是说，只要知道接收端的IP和端口，且网络是可达的，任何主机都可以向接收端发送数据。这时候，如果一次能读取超过一个报文的数据，则会乱套。比如，主机A向发送了报文P1，主机B发送了报文P2，如果能够读取超过一个报文的数据，那么就会将P1和P2的数据合并在了一起，这样的数据是没有意义的。
 ```
 ## TCP
 - 特点
 ```text
 TCP 是面向连接的运输层协议。应用程序在使用 TCP 协议之前，必须先建立 TCP 连接。在传送数据完毕后，必须释放已经建立的 TCP 连接
 每一条 TCP 连接只能有两个端点，每一条 TCP 连接只能是点对点的(一对一)
 TCP 提供可靠交付的服务。通过 TCP 连接传送的数据，无差错、不丢失、不重复，并且按序到达
 TCP 提供全双工通信。TCP 允许通信双方的应用进程在任何时候都能发送数据。TCP 连接的两端都设有发送缓存和接受缓存，用来临时存放双向通信的数据
 面向字节流。TCP 中的“流”指的是流入到进程或从进程流出的字节序列。
 ```
 - TCP的三次握手和四次挥手
 
  ![image](https://github.com/jeremyke/PHPBlog/raw/master/Pictures/20190911161400.png)
  
 （1）当A想同主机B建立连接，A会先发送SYN=1,ACK=0给主机B，初始化序列号seq=x。主机A通过向主机B发送SYN报文段，实现从主机A到主机B的序列号同步，即确定seq中的x。
  
 （2）主机B接收到报文后，同意与A建立连接，会发送SYN=1、ACK=1给主机A。初始化序列号seq=y，确认序号ack=x+1。主机B向主机A发送SYN报文的目的是实现从主机B到主机A的序列号同步，即确定seq中的y。
  
 （3）主机A接收到主机B发送过来的报文后，会发送ACK=1给主机B，确认序号ack=y+1，建立连接完成，可以传输数据。
 
  ![image](https://github.com/jeremyke/PHPBlog/raw/master/Pictures/cfa49ef52add4d183c3f977ee137d2fe_70.png)
  
 （1）当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FIN附加标记的报文段，初始化序号seq=x。
  
 （2）主机B收到这个FIN报文段，并不立即用FIN报文段回复主机A，而是向主机A发送一个确认序号ack=x+1，同时通知自己的应用程序，对方要求关闭连接（先发ack是防止主机A重复发送FIN报文）。
  
 （3）主机B发送完ack确认报文后，主机B 的应用程序通知TCP我要关闭连接，TCP接到通知后会向主机A发送一个带有FIN附加标记的报文段，初始化序号seq=x，ack=x+1。
  
 （4）主机A收到这个FIN报文段，向主机B发送一个ack确认报文，ack=y+1，表示连接彻底释放。
 
 ## UDP、TCP 区别，适用场景
 
 - 对比
 
 |对比项|UDP|TCP|
 |-|-|-|
 |连接性|无连接|面向连接|
 |可靠性|不可靠|可靠|
 |报文|面向报文-数据报模式|面向字节流-流模式|
 |双工性|一对一、一对多、多对一、多对多|全双工|
 |流量控制|无|有(滑动窗口)|
 |拥塞控制|无|有(慢开始、拥塞避免、快重传、快恢复)|
 |传输速度|快|慢|
 |资源要求|较少|较多|
 |首部开销|8字节|20字节|
 |数据顺序|不保证|保证|
 
 - UDP 适用场景
 
 面向数据报方式、网络数据大多为短消息、拥有大量 Client、对数据安全性无特殊要求、网络负担非常重，但对响应速度要求高
 
 - TCP 适用场景
 文件传输(FTP HTTP 对数据准确性要求较高，速度可以相对慢) 发送或接收邮件(POP IMAP SMTP 对数据准确性要求高，非紧急应用) 远程登录
 (telnet SSH 对数据准确性有要求，有连接的概念)
 
 ## Http详解
 - HTTP 报文组成部分
 
 起始行：报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况
 首部字段：起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值
 主体：空行之后就是可选的报文主体了，其中包含了所有类型的数据
 
 ```text
 请求包含：请求行；请求头；请求主体
 HTTP请求头详解：
     •   Accept ：可接受的数据类型（text/html，image/png）
     •   Referer ：请求来源
     •   Accept-Language ：可识别的语言类型
     •   User-Agent ：用户代理信息（描述浏览器，可以用于判断用户的浏览器类型）
     •   Accept-Encoding ：数据压缩算法（静态化技术）
     •   If-Modified-Since ：（html、images、css、js）数据缓存的最后修改时间
 响应包含：响应行；响应头；响应内容
 HTTP响应头详解：
     •   Date ：响应时间
     •   Server ：服务器相关信息（Apache与PHP版本）
     •   Last-Modified ：文件的最后修改时间
     •   Content-Length ：响应内容的字节长度
     •   Content-Type ：响应内容的类型
     •   Location ：重定向
     •   Refresh ：停留N秒后跳转
     •   Expires、Cache-Control ：缓存文件的过期时间与缓存开关
     •   Content-Encoding ：响应内容压缩算法
 错误码：
     200 ：服务器端已成功接收到数据并进行了处理，然后返回到客户端（正常请求）
     301 ：资源被永久转移
     302 ：资源被临时转移
     304 ：资源已被缓存
     307 ：资源为临时资源
     400 ：告知客户端发送了错误请求
     403 ：请求被服务器拒绝
     404 ：请求的服务器端资源未找到
     413 ：请求实体过大
     500 ：服务器端出错
     503 ：无法为请求提供服务（负载过大）
     504：代理或网关超时(等待另一服务器响应超时)
 ```
 ## socket
 
 - 步骤
 ```text
 创建 socket
 绑定 socket 到指定地址和端口
 开始监听连接
 读取客户端输入
 关闭 socket
 ```
 ## websocket
 >WebSocket 是一种通信协议，定义了一个全双工通信信道，仅通过 Web 上的一个 Socket 即可进行通信
 
 - 特点
 推送功能：支持由服务器向客户端推送数据的推送功能
 减少通信量：只要建立起 WebSocket 连接，就希望一直保持连接状态
 
 - 示意图
 
 ![image](https://github.com/jeremyke/PHPBlog/raw/master/Pictures/network-websocket.png)
 